[gd_scene load_steps=24 format=3 uid="uid://7875cslq4u7k"]

[ext_resource type="Script" uid="uid://hqgxto1ffhuf" path="res://src/player/clerical_machine/GroundedBehavior.cs" id="1_n8edh"]
[ext_resource type="Script" uid="uid://c3rhg5tpr18e1" path="res://src/player/clerical_machine/AirborneBehavior.cs" id="2_iul5a"]
[ext_resource type="Script" uid="uid://couw105c3bde4" path="res://addons/godot_state_charts/state_chart.gd" id="3_ermlh"]
[ext_resource type="Script" uid="uid://c1vp0ojjvaby1" path="res://addons/godot_state_charts/parallel_state.gd" id="4_h5l0u"]
[ext_resource type="Script" uid="uid://jk2jm1g6q853" path="res://addons/godot_state_charts/compound_state.gd" id="5_c6mmw"]
[ext_resource type="Script" uid="uid://cytafq8i1y8qm" path="res://addons/godot_state_charts/atomic_state.gd" id="6_hb5qs"]
[ext_resource type="Script" uid="uid://cf1nsco3w0mf6" path="res://addons/godot_state_charts/transition.gd" id="7_imwnx"]
[ext_resource type="Script" uid="uid://le5w1cm0ul8p" path="res://addons/godot_state_charts/expression_guard.gd" id="8_vaun6"]
[ext_resource type="Script" uid="uid://bambbrd2wupx0" path="res://addons/godot_state_charts/state_is_active_guard.gd" id="9_a8h0j"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_ylhto"]
x_label = "Direction"
y_label = "Velocity"
blend_mode = 1

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_cwolq"]

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_2smqc"]
input_0/name = "Airborne"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "Grounded"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_rl62b"]
nodes/output/position = Vector2(640, 200)
nodes/AirOrientation/node = SubResource("AnimationNodeBlendSpace2D_ylhto")
nodes/AirOrientation/position = Vector2(40, 40)
nodes/Location/node = SubResource("AnimationNodeTransition_2smqc")
nodes/Location/position = Vector2(360, 120)
nodes/GroundOrientation/node = SubResource("AnimationNodeBlendSpace2D_cwolq")
nodes/GroundOrientation/position = Vector2(40, 300)
node_connections = [&"output", 0, &"Location", &"Location", 0, &"AirOrientation", &"Location", 1, &"GroundOrientation"]

[sub_resource type="Resource" id="Resource_fpteg"]
script = ExtResource("8_vaun6")
expression = "false"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_54rhl"]
script = ExtResource("8_vaun6")
expression = "false"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_gyrcp"]
script = ExtResource("8_vaun6")
expression = "false"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_wme3t"]
script = ExtResource("8_vaun6")
expression = "false"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_q6d88"]
script = ExtResource("8_vaun6")
expression = "false"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_jdgu0"]
script = ExtResource("8_vaun6")
expression = "Velocity.y > 0.0"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_xhhjd"]
script = ExtResource("9_a8h0j")
state = NodePath("../../../Buffer/NoJump")
metadata/_custom_type_script = "uid://bambbrd2wupx0"

[sub_resource type="Resource" id="Resource_rjcp7"]
script = ExtResource("8_vaun6")
expression = "Velocity.x < -_AirVelThreshold"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_040dy"]
script = ExtResource("8_vaun6")
expression = "Velocity.x > _AirVelThreshold"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[sub_resource type="Resource" id="Resource_5bx0s"]
script = ExtResource("8_vaun6")
expression = "Velocity.y > _AirGravThreshold"
metadata/_custom_type_script = "uid://le5w1cm0ul8p"

[node name="PlayerLogic" type="AnimationTree"]
tree_root = SubResource("AnimationNodeBlendTree_rl62b")
anim_player = NodePath("../AnimationPlayer")
parameters/AirOrientation/blend_position = Vector2(0, 0)
parameters/Location/current_state = "Airborne"
parameters/Location/transition_request = ""
parameters/Location/current_index = 0
parameters/GroundOrientation/blend_position = Vector2(0, 0)

[node name="GroundedBehavior" type="Node" parent="."]
script = ExtResource("1_n8edh")

[node name="AirborneHorizBehavior" type="Node" parent="."]
script = ExtResource("2_iul5a")

[node name="AirborneVertBehavior" type="Node" parent="."]

[node name="StateChart" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("3_ermlh")
track_in_editor = true
initial_expression_properties = {
&"Velocity": Vector2(0, 0),
&"_AirGravThreshold": 0.0,
&"_AirJumpBufferTime": 0.09,
&"_AirVelThreshold": 0.0,
&"_GndCoyoteTime": 0.09
}
metadata/_custom_type_script = "uid://couw105c3bde4"

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("4_h5l0u")
metadata/_custom_type_script = "uid://c1vp0ojjvaby1"

[node name="XBoosting" type="Node" parent="StateChart/Root"]
process_mode = 4
script = ExtResource("5_c6mmw")
initial_state = NodePath("BoostOff")

[node name="BoostOff" type="Node" parent="StateChart/Root/XBoosting"]
script = ExtResource("6_hb5qs")

[node name="BoostOn" type="Node" parent="StateChart/Root/XBoosting"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("BoostLeft")

[node name="BoostLeft" type="Node" parent="StateChart/Root/XBoosting/BoostOn"]
script = ExtResource("6_hb5qs")

[node name="BoostRight" type="Node" parent="StateChart/Root/XBoosting/BoostOn"]
script = ExtResource("6_hb5qs")

[node name="AtBoostDecay" type="Node" parent="StateChart/Root/XBoosting/BoostOn"]
script = ExtResource("7_imwnx")
to = NodePath("../../BoostOff")
guard = SubResource("Resource_fpteg")
delay_in_seconds = "0.0"

[node name="Location" type="Node" parent="StateChart/Root"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Airborne")

[node name="Grounded" type="Node" parent="StateChart/Root/Location"]
script = ExtResource("4_h5l0u")

[node name="Vertical" type="Node" parent="StateChart/Root/Location/Grounded"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Stable")

[node name="Stable" type="Node" parent="StateChart/Root/Location/Grounded/Vertical"]
script = ExtResource("6_hb5qs")

[node name="OnFall" type="Node" parent="StateChart/Root/Location/Grounded/Vertical/Stable"]
script = ExtResource("7_imwnx")
to = NodePath("../../CoyoteTime")
event = &"Fall"
delay_in_seconds = "0.0"

[node name="CoyoteTime" type="Node" parent="StateChart/Root/Location/Grounded/Vertical"]
script = ExtResource("6_hb5qs")

[node name="OnLanding" type="Node" parent="StateChart/Root/Location/Grounded/Vertical/CoyoteTime"]
script = ExtResource("7_imwnx")
to = NodePath("../../Stable")
event = &"Landing"
delay_in_seconds = "0.0"

[node name="Timeout" type="Node" parent="StateChart/Root/Location/Grounded/Vertical/CoyoteTime"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../Airborne/Vertical/Fall/QuickFall")
delay_in_seconds = "_GndCoyoteTime"

[node name="OnJump" type="Node" parent="StateChart/Root/Location/Grounded/Vertical"]
script = ExtResource("7_imwnx")
to = NodePath("../../../Airborne/Vertical/Jump/JumpRise")
event = &"Jump"
delay_in_seconds = "0.0"

[node name="Horizonal" type="Node" parent="StateChart/Root/Location/Grounded"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Locomotion")

[node name="BufferedJump" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal"]
script = ExtResource("6_hb5qs")

[node name="Timeout" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal/BufferedJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../Airborne/Vertical/Jump/JumpRise")
delay_in_seconds = "0.000010000001"

[node name="Locomotion" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal"]
script = ExtResource("6_hb5qs")

[node name="XAtBoostThreshold" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal/Locomotion"]
process_mode = 4
script = ExtResource("7_imwnx")
to = NodePath("../../XBoostBuilding")
guard = SubResource("Resource_54rhl")
delay_in_seconds = "0.0"

[node name="XBoostBuilding" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal"]
process_mode = 4
script = ExtResource("6_hb5qs")

[node name="AtSpeedLoss" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal/XBoostBuilding"]
script = ExtResource("7_imwnx")
to = NodePath("../../Locomotion")
guard = SubResource("Resource_gyrcp")
delay_in_seconds = "0.0"

[node name="AtBoostLeft" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal/XBoostBuilding"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../../XBoosting/BoostOn/BoostLeft")
guard = SubResource("Resource_wme3t")
delay_in_seconds = "0.0"

[node name="AtBoostRight" type="Node" parent="StateChart/Root/Location/Grounded/Horizonal/XBoostBuilding"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../../XBoosting/BoostOn/BoostRight")
guard = SubResource("Resource_q6d88")
delay_in_seconds = "0.0"

[node name="Airborne" type="Node" parent="StateChart/Root/Location"]
script = ExtResource("4_h5l0u")

[node name="Vertical" type="Node" parent="StateChart/Root/Location/Airborne"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Fall")

[node name="Jump" type="Node" parent="StateChart/Root/Location/Airborne/Vertical"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("JumpRise")

[node name="JumpRise" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Jump"]
script = ExtResource("6_hb5qs")

[node name="AtPeak" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Jump/JumpRise"]
script = ExtResource("7_imwnx")
to = NodePath("../../../Fall/SlowFall")
guard = SubResource("Resource_jdgu0")
delay_in_seconds = "0.0"

[node name="OnJumpCancel" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Jump/JumpRise"]
script = ExtResource("7_imwnx")
to = NodePath("../../JumpBrake")
event = &"JumpCancel"
delay_in_seconds = "0.0"

[node name="JumpBrake" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Jump"]
script = ExtResource("6_hb5qs")

[node name="AtPeak" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Jump/JumpBrake"]
script = ExtResource("7_imwnx")
to = NodePath("../../../Fall/QuickFall")
guard = SubResource("Resource_xhhjd")
delay_in_seconds = "0.0"

[node name="Fall" type="Node" parent="StateChart/Root/Location/Airborne/Vertical"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("QuickFall")

[node name="SlowFall" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Fall"]
script = ExtResource("6_hb5qs")

[node name="OnJumpCancel" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Fall/SlowFall"]
script = ExtResource("7_imwnx")
to = NodePath("../../QuickFall")
event = &"JumpCancel"
delay_in_seconds = "0.0"

[node name="QuickFall" type="Node" parent="StateChart/Root/Location/Airborne/Vertical/Fall"]
script = ExtResource("6_hb5qs")

[node name="Horizontal" type="Node" parent="StateChart/Root/Location/Airborne"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Restricted")

[node name="Restricted" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("Neutral")

[node name="Neutral" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted"]
script = ExtResource("6_hb5qs")

[node name="AtLeft" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted/Neutral"]
script = ExtResource("7_imwnx")
to = NodePath("../../Left")
guard = SubResource("Resource_rjcp7")
delay_in_seconds = "0.0"

[node name="AtRight" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted/Neutral"]
script = ExtResource("7_imwnx")
to = NodePath("../../Right")
guard = SubResource("Resource_040dy")
delay_in_seconds = "0.0"

[node name="Left" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted"]
script = ExtResource("6_hb5qs")

[node name="Right" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted"]
script = ExtResource("6_hb5qs")

[node name="AtFallThreshold" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal/Restricted"]
script = ExtResource("7_imwnx")
to = NodePath("../../Unrestricted")
guard = SubResource("Resource_5bx0s")
delay_in_seconds = "0.0"

[node name="Unrestricted" type="Node" parent="StateChart/Root/Location/Airborne/Horizontal"]
script = ExtResource("6_hb5qs")

[node name="Buffer" type="Node" parent="StateChart/Root/Location/Airborne"]
script = ExtResource("5_c6mmw")
initial_state = NodePath("NoJump")

[node name="NoJump" type="Node" parent="StateChart/Root/Location/Airborne/Buffer"]
script = ExtResource("6_hb5qs")

[node name="OnJump" type="Node" parent="StateChart/Root/Location/Airborne/Buffer/NoJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../LandingJump")
event = &"Jump"
delay_in_seconds = "0.0"

[node name="OnLanding" type="Node" parent="StateChart/Root/Location/Airborne/Buffer/NoJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../Grounded/Vertical/Stable")
event = &"Landing"
delay_in_seconds = "0.0"

[node name="LandingJump" type="Node" parent="StateChart/Root/Location/Airborne/Buffer"]
script = ExtResource("6_hb5qs")

[node name="OnJumpCancel" type="Node" parent="StateChart/Root/Location/Airborne/Buffer/LandingJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../NoJump")
event = &"JumpCancel"
delay_in_seconds = "0.0"

[node name="OnLanding" type="Node" parent="StateChart/Root/Location/Airborne/Buffer/LandingJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../../../Grounded/Horizonal/BufferedJump")
event = &"Landing"
delay_in_seconds = "0.0"

[node name="Timeout" type="Node" parent="StateChart/Root/Location/Airborne/Buffer/LandingJump"]
script = ExtResource("7_imwnx")
to = NodePath("../../NoJump")
delay_in_seconds = "_AirJumpBufferTime"

[connection signal="state_entered" from="StateChart/Root/Location/Grounded" to="GroundedBehavior" method="OnGroundedEnter"]
[connection signal="state_exited" from="StateChart/Root/Location/Grounded" to="GroundedBehavior" method="OnGroundedExit"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Grounded/Vertical/Stable" to="GroundedBehavior" method="OnGroundedStableTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Grounded/Vertical/CoyoteTime" to="GroundedBehavior" method="OnGroundedCoyoteTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Grounded/Horizonal/BufferedJump" to="GroundedBehavior" method="OnGroundedLocomotionTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Grounded/Horizonal/Locomotion" to="GroundedBehavior" method="OnGroundedLocomotionTick"]
[connection signal="state_entered" from="StateChart/Root/Location/Airborne/Vertical/Jump/JumpRise" to="AirborneHorizBehavior" method="OnJumpRiseEnter"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Vertical/Jump/JumpRise" to="AirborneHorizBehavior" method="OnJumpRiseTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Vertical/Jump/JumpBrake" to="AirborneHorizBehavior" method="OnJumpBrakeTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Vertical/Fall/SlowFall" to="AirborneHorizBehavior" method="OnSlowFallTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Vertical/Fall/QuickFall" to="AirborneHorizBehavior" method="OnQuickFallTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Horizontal/Restricted/Neutral" to="AirborneHorizBehavior" method="OnHorizontalUnrestrictedTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Horizontal/Restricted/Left" to="AirborneHorizBehavior" method="OnHorizontalRestrictedLeftTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Horizontal/Restricted/Right" to="AirborneHorizBehavior" method="OnHorizontalRestrictedRightTick"]
[connection signal="state_physics_processing" from="StateChart/Root/Location/Airborne/Horizontal/Unrestricted" to="AirborneHorizBehavior" method="OnHorizontalUnrestrictedTick"]
